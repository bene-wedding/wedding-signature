<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>BENE Wedding – Write</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css?family=Sarabun&display=swap" rel="stylesheet">

<style>
body{
  font-family:Sarabun,sans-serif;
  background:#fafafa;
  text-align:center;
  margin:0;
}
h1{ margin:16px 0 6px; }

canvas{
  border:2px solid #000;
  background:#fff;
  touch-action:none;
}

.controls{ margin:10px 0; }
button,select{
  font-size:16px;
  padding:6px 12px;
  margin:4px;
}
</style>
</head>
<body>

<h1>เขียนคำอวยพรให้บ่าวสาว</h1>
<p>เมาส์ / ปากกา / นิ้ว</p>

<canvas id="canvas" width="900" height="600"></canvas>

<div class="controls">
  สี:
  <select id="color">
    <option value="black">ดำ</option>
    <option value="blue" selected>น้ำเงิน</option>
    <option value="red">แดง</option>
    <option value="green">เขียว</option>
  </select>

  ความหนา:
  <select id="width">
    <option value="6">6</option>
    <option value="8" selected>8</option>
    <option value="12">12</option>
  </select>
</div>

<div class="controls">
  <button onclick="clearCanvas()">ล้าง</button>
  <button onclick="saveCanvas()">ส่ง</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const colorEl = document.getElementById("color");
const widthEl = document.getElementById("width");

let drawing = false;
let lastX = 0;
let lastY = 0;

/* ===== คำนวณตำแหน่ง ===== */
function getXY(e){
  const rect = canvas.getBoundingClientRect();
  return {
    x: (e.clientX - rect.left),
    y: (e.clientY - rect.top)
  };
}

/* ===== MOUSE ===== */
canvas.addEventListener("mousedown", e => {
  drawing = true;
  const pos = getXY(e);
  lastX = pos.x;
  lastY = pos.y;
});

canvas.addEventListener("mousemove", e => {
  if(!drawing) return;
  const pos = getXY(e);

  ctx.strokeStyle = colorEl.value;
  ctx.lineWidth = widthEl.value;
  ctx.lineCap = "round";

  ctx.beginPath();
  ctx.moveTo(lastX, lastY);
  ctx.lineTo(pos.x, pos.y);
  ctx.stroke();

  lastX = pos.x;
  lastY = pos.y;
});

window.addEventListener("mouseup", ()=> drawing=false);

/* ===== TOUCH ===== */
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  drawing = true;
  const t = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  lastX = t.clientX - rect.left;
  lastY = t.clientY - rect.top;
});

canvas.addEventListener("touchmove", e => {
  if(!drawing) return;
  e.preventDefault();

  const t = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  const x = t.clientX - rect.left;
  const y = t.clientY - rect.top;

  ctx.strokeStyle = colorEl.value;
  ctx.lineWidth = widthEl.value;
  ctx.lineCap = "round";

  ctx.beginPath();
  ctx.moveTo(lastX, lastY);
  ctx.lineTo(x, y);
  ctx.stroke();

  lastX = x;
  lastY = y;
});

canvas.addEventListener("touchend", ()=> drawing=false);

/* ===== CLEAR ===== */
function clearCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

/* ===== SAVE (เทสก่อน) ===== */
function saveCanvas(){
  alert("เขียนติดแล้ว ✔ ต่อไปผูก Supabase");
}
</script>

</body>
</html>
