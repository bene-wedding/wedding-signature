<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>Bene Wedding Project</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css?family=Sarabun&display=swap" rel="stylesheet">

<style>
body{
  font-family:Sarabun,sans-serif;
  background:#fafafa;
  text-align:center;
  margin:0;
}
h1{ margin:16px 0 4px; }
canvas{
  border:2px solid #000;
  background:#fff;
  touch-action:none;
  cursor:crosshair;
}
.controls{ margin:10px 0; }
button,select{
  font-size:16px;
  padding:6px 12px;
  margin:4px;
}
</style>
</head>
<body>

<h1>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÉ‡∏´‡πâ‡∏ö‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏ß</h1>
<p>‡πÉ‡∏ä‡πâ‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤ / ‡∏ô‡∏¥‡πâ‡∏ß / ‡πÄ‡∏°‡∏≤‡∏™‡πå ‡πÑ‡∏î‡πâ</p>

<canvas id="canvas" width="900" height="600"></canvas>

<div class="controls">
  ‡∏™‡∏µ:
  <select id="color">
    <option value="black">‡∏î‡∏≥</option>
    <option value="blue" selected>‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô</option>
    <option value="red">‡πÅ‡∏î‡∏á</option>
    <option value="green">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</option>
  </select>

  ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤:
  <select id="width">
    <option value="6">6</option>
    <option value="8" selected>8</option>
    <option value="12">12</option>
  </select>
</div>

<div class="controls">
  <button onclick="clearCanvas()">‡∏•‡πâ‡∏≤‡∏á</button>
  <button onclick="saveCanvas()">‡∏™‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// üîë Supabase
const SUPABASE_URL="https://ntyqqenchkojmhfyaegx.supabase.co";
const SUPABASE_ANON_KEY="sb_publishable_NRo3h3EI9GBoZQJ5n4gOSg_waxkqG-N";
const supabase=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

// ===== Canvas =====
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const colorEl=document.getElementById("color");
const widthEl=document.getElementById("width");

let drawing=false;
let lastX=0,lastY=0;

// Pointer Events
canvas.addEventListener("pointerdown",e=>{
  drawing=true;
  canvas.setPointerCapture(e.pointerId);
  lastX=e.offsetX;
  lastY=e.offsetY;
});

canvas.addEventListener("pointermove",e=>{
  if(!drawing) return;

  ctx.strokeStyle=colorEl.value;
  ctx.lineWidth=widthEl.value;
  ctx.lineCap="round";
  ctx.lineJoin="round";

  ctx.beginPath();
  ctx.moveTo(lastX,lastY);
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();

  lastX=e.offsetX;
  lastY=e.offsetY;
});

canvas.addEventListener("pointerup",()=>drawing=false);
canvas.addEventListener("pointercancel",()=>drawing=false);
canvas.addEventListener("pointerleave",()=>drawing=false);

// ‡∏•‡πâ‡∏≤‡∏á
function clearCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
async function saveCanvas(){
  const blob=await new Promise(r=>canvas.toBlob(r,"image/png"));
  const filename=`signature_${Date.now()}.png`;

  await supabase.storage.from("signatures")
    .upload(filename,blob,{upsert:true});

  const { data } = supabase.storage
    .from("signatures")
    .getPublicUrl(filename);

  await supabase.from("signatures").insert({
    image_url:data.publicUrl
  });

  clearCanvas();
  alert("‡∏™‡πà‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úçÔ∏è");
}
</script>

</body>
</html>
